#!/bin/bash

rm ../logging*.tar.gz

# build high-date from files
# $Id: logger.R 8906 2010-03-09 07:49:46Z Mario $

MAX=$(egrep -hro "[$]Id: .*[$]" . | ( 
  HIGH=0
  while read line
  do
    RREV=$( echo $line | egrep -hro "[ ][0-9]+[ ]" ) 
    if [ $RREV -gt $HIGH ] 
    then 
      HIGH=$RREV
      maxline=$line
    fi
  done
  echo $maxline
))

HIGH=$(( $( echo $MAX | egrep -hro "[ ][0-9]+[ ]" ) ))
DATE=$( echo $MAX | egrep -hro "[0-9-]+[ ][0-9:]+Z" )

echo "- $HIGH:$DATE"

sed -re "s/(^Version:[^-]*).+$/\1-$HIGH/" DESCRIPTION.template > DESCRIPTION

now=$(date)
cat <<EOF > R/version.R
# Do not edit!  This file was autogenerated
#      by $0
#      on $now
#
# SVNVERSION as reported by svnversion at that point in time,

SVNVERSION <- "$HIGH"
SVNDATE <- "$DATE"

EOF
